<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Vue $attrs/$listeners 爺孫組件資料傳遞 · Emmie's Blog</title><meta name="description" content="Vue $attrs/$listeners 爺孫組件資料傳遞 - Emmie"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://linxinemily.github.io/atom.xml" title="Emmie's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/linxinemily" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/categories/" target="_self" class="nav-list-link">CATEGORIES</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Vue $attrs/$listeners 爺孫組件資料傳遞</h1><a class="article-category-link" href="/categories/Vue/">Vue</a><div class="post-info">Jun 23, 2019</div><div class="post-content"><p>平常在實作 Vue 組件之間的資料傳遞大部分都是透過 <code>props</code> 及 <code>$emit</code>，或是直接經由 Vuex 進行狀態管理，而除了這兩種方法，還有另外一種做法是透過 <code>$attrs</code> 及 <code>$listenter</code>。</p>
<p>本身也是因為之前偶然在查資料的時候看到這兩個 API，但當時看過別人寫的文章後卻只是似懂非懂，頂多知道有這個東西但不知道如何使用或該用在什麼場合，一直到實作時才真正理解它的用法，但多看多讀總是好的，有一天或許派得上用場。</p>
<h2 id="attrs"><a href="#attrs" class="headerlink" title="$attrs"></a><code>$attrs</code></h2><p>其實簡單說就是子組件可以透過<code>$attrs</code>取得父組件當中<em>除了 Props 以外</em>的所有資料。</p>
<p>乍看之下好像沒什麼，那不就直接用 Props 就好了嗎？<br>但當在多重組件嵌套的情況之下，就會顯得很有用。我們先定義出三個組件，他們分別是： a-component（爺組件/模板）、b-component（父組件）、c-component（孫組件）</p>
<p>我們可以在 a 使用 b：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// a-component</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b-component</span> <span class="attr">:msg</span>=<span class="string">"hello"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接著在 b 中我們可以使用 <code>$attrs</code> 而不用透過 Props 拿到 <code>apiUrl</code>，並且將 <code>$attrs</code> 透過 <code>v-bind</code> 綁定在 c 上傳給 c 使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// b-component</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; $attrs.data &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">c-component</span> <span class="attr">v-bind</span>=<span class="string">"$attrs"</span>/&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然後同樣在 c 當中我們就能夠透過<code>$attrs</code>取得 a 的資料 。這樣一來的好處就是當我們有多個資料要從 a 傳給 b 跟 c 共用時，不用每一層都要聲明 Props，然後還要將每個 Props 寫在 component 的標籤裡面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// c-component</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; $attrs.data &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>和 <code>$attrs</code> 相關的 API 還有 <code>inheritAttrs</code>，其值為布林值，預設為 <code>true</code>，也就是如果我們沒有特別將其設定成 <code>false</code>，子組件默認可以透過 <code>$attrs</code> 取得在父組件當中非透過 Props 繼承的資料。</p>
</blockquote>
<h2 id="listeners"><a href="#listeners" class="headerlink" title="$listeners"></a>$listeners</h2><p>應該不難猜想， <code>$attrs</code>  對應 Props ，<code>$listeners</code> 則對應 <code>$emit</code>。
簡單來說就是父組件可以透過 <code>$listeners</code> 取得所有子組件 <code>$emit</code> 打出來的事件。同樣以上面三個組件為例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// c-component</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"$emit('sayHi')"</span>&gt;</span> click me!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 b 當中同樣可以透過 <code>v-on=&quot;$listeners&quot;</code>將 c 事件委任給 a：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// b-component</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c-component</span> <span class="attr">v-on</span>=<span class="string">"$listeners"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>a 就可以直接處理 c 打出的<code>$emit</code>事件，而不用透過 b 再 emit 一次</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// a-component</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b-component</span> @<span class="attr">sayHi</span>=<span class="string">"anEventHandler"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>所以當多重組件之間需要溝通傳遞，但不想用 Vuex 時，可以嘗試採用這兩種方法：<br>    * <code>$attrs</code>：孫組件取得爺組件的資料<br>    * <code>$listeners</code>：爺組件直接觸發孫組件的事件</p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/06/11/使用vue-echarts踩的坑/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 <a href="https://linxinemily.github.io">Emmie</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>