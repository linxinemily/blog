<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 使用 vue-echarts 踩的坑 · Emmie's Blog</title><meta name="description" content="使用 vue-echarts 踩的坑 - Emmie"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://linxinemily.github.io/atom.xml" title="Emmie's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/linxinemily" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/categories/" target="_self" class="nav-list-link">CATEGORIES</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">使用 vue-echarts 踩的坑</h1><a class="article-category-link" href="/categories/Vue/">Vue</a><div class="post-info">Jun 11, 2019</div><div class="post-content"><p>第一次使用 Echarts 這套圖形 library，在 vue 中使用 Echarts 可以直接裝 vue-echart，官方文件推薦兩個都裝：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install echarts vue-echarts</span><br></pre></td></tr></table></figure>

<p>預料之中的踩了不少坑，在此紀錄一些重點。</p>
<a id="more"></a>

<h2 id="安裝完後引入並註冊圖表-component"><a href="#安裝完後引入並註冊圖表-component" class="headerlink" title="安裝完後引入並註冊圖表 component"></a>安裝完後引入並註冊圖表 component</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> ECharts <span class="keyword">from</span> <span class="string">'vue-echarts'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'echarts/lib/chart/bar'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'echarts/lib/component/tooltip'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'echarts-gl'</span> <span class="comment">//等等會使用 grapic 設定圖形文字，故需載入此 module</span></span><br><span class="line"></span><br><span class="line">Vue.component(<span class="string">'v-chart'</span>, ECharts) <span class="comment">// 註冊為 global component</span></span><br></pre></td></tr></table></figure>

<h2 id="基礎使用"><a href="#基礎使用" class="headerlink" title="基礎使用"></a>基礎使用</h2><p>在 template 中可以直接使用圖表 component，其接收 <code>options</code> 為 props，裡面的<code>series</code>屬性為設置特定類型圖表的屬性，在此使用專案中的圓餅圖當範例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">v-chart</span> <span class="attr">:options</span>=<span class="string">"options"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        options: &#123;</span><br><span class="line">            series: [</span><br><span class="line">                &#123;</span><br><span class="line">                    type: <span class="string">'pie'</span>,  <span class="comment">// 必須</span></span><br><span class="line">                    name: <span class="string">'test'</span>, <span class="comment">// 必須</span></span><br><span class="line">                    radius: [<span class="string">'50%'</span>, <span class="string">'70%'</span>],</span><br><span class="line">                    label: &#123;</span><br><span class="line">                    normal: &#123;</span><br><span class="line">                        show: <span class="literal">false</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    emphasis: &#123;</span><br><span class="line">                        show: <span class="literal">true</span>,</span><br><span class="line">                        formatter: <span class="string">'&#123;b&#125; &#123;@percentage&#125;%'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    data: [</span><br><span class="line">                    &#123; <span class="attr">name</span>: <span class="string">'韓國'</span>, <span class="attr">value</span>: <span class="number">70</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">name</span>: <span class="string">'日本'</span>, <span class="attr">value</span>: <span class="number">10</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">name</span>: <span class="string">'台灣'</span>, <span class="attr">value</span>: <span class="number">10</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">name</span>: <span class="string">'越南'</span>, <span class="attr">value</span>: <span class="number">6</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">name</span>: <span class="string">'中國'</span>, <span class="attr">value</span>: <span class="number">3</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">name</span>: <span class="string">'其他'</span>, <span class="attr">value</span>: <span class="number">1</span> &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="圓餅圖中間加入文字"><a href="#圓餅圖中間加入文字" class="headerlink" title="圓餅圖中間加入文字"></a>圓餅圖中間加入文字</h2><blockquote>
<p>注意：<strong>一定要裝 <code>echarts-gl</code> 模組</strong>，否則會無法顯示。<br>可以直接利用官方提供的屬性<code>grapic</code>為圖表自行添加圖形元素，並新增特定文字（可以新增的圖形元素類型還有圖片、圖形等，可以參考<a href="https://echarts.baidu.com/option.html#graphic" target="_blank" rel="noopener">文件</a>），格式如下：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">graphic: [</span><br><span class="line">          &#123;</span><br><span class="line">            type: <span class="string">'text'</span>,</span><br><span class="line">            left: <span class="string">'center'</span>,</span><br><span class="line">            top: <span class="string">'center'</span>,</span><br><span class="line">            style: &#123;</span><br><span class="line">              text: <span class="string">'學生國籍比例'</span>,</span><br><span class="line">              textAlign: <span class="string">'center'</span>,</span><br><span class="line">              fill: <span class="string">'#666'</span>,</span><br><span class="line">              font: <span class="string">'20px "STHeiti", sans-serif'</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>

<h2 id="圖例說明（legend）需要添加-value-資料"><a href="#圖例說明（legend）需要添加-value-資料" class="headerlink" title="圖例說明（legend）需要添加 value 資料"></a>圖例說明（legend）需要添加 value 資料</h2><p>echarts 提供的 formater callback function 只有給我們 <code>name</code> 這個參數，所以要同時拿到 <code>value</code> 的話，會需要自己從圖表實例裡面找。</p>
<blockquote>
<p>注意：<strong>必須使用箭頭函式</strong>才能拿到這個 component 的實例，進而取得 <code>options.series[0].data</code> 得到我們要的 <code>value</code></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">legend: &#123;</span><br><span class="line">          orient: <span class="string">'verticle'</span>,</span><br><span class="line">          left: <span class="string">'left'</span>,</span><br><span class="line">          bottom: <span class="string">'middle'</span>,</span><br><span class="line">          textStyle: &#123;</span><br><span class="line">            fontSize: <span class="number">16</span></span><br><span class="line">          &#125;,</span><br><span class="line">          formatter: <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">this</span>.options.series[<span class="number">0</span>].data</span><br><span class="line">            <span class="keyword">let</span> targetValue</span><br><span class="line">            data.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (item.name === name) &#123;</span><br><span class="line">                targetValue = item.value</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">return</span> name + <span class="string">' '</span> + targetValue + <span class="string">'%'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="圖表的響應"><a href="#圖表的響應" class="headerlink" title="圖表的響應"></a>圖表的響應</h2><p>由於一開始設定圖例的排列方式為垂直排列、靠左並置中，但在行動裝置上這樣會破版，所以首先第一步先設定讓整個 Canvas 可以自適應容器大小縮放，實現方法其實只要修改 CSS 即可：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.echarts</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接著就會面臨到圖例跟圖表本體重疊的問題，所以我們需要偵測視窗寬度大小，隨著裝置寬度不同改變圖例排列的方式。</p>
<h4 id="1-首先先在-component-上綁定-ref"><a href="#1-首先先在-component-上綁定-ref" class="headerlink" title="1. 首先先在 component 上綁定 ref"></a>1. 首先先在 component 上綁定 <code>ref</code></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">v-chart</span> <span class="attr">ref</span>=<span class="string">"myChart"</span> <span class="attr">:options</span>=<span class="string">"options"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-在-mounted-當中監聽-window-的-load-event，當頁面載入時計算當前螢幕寬度大小，再透過-ref-屬性訪問該圖表實例並修改其-options-legend-屬性（和圖例定位相關的屬性）"><a href="#2-在-mounted-當中監聽-window-的-load-event，當頁面載入時計算當前螢幕寬度大小，再透過-ref-屬性訪問該圖表實例並修改其-options-legend-屬性（和圖例定位相關的屬性）" class="headerlink" title="2. 在 mounted 當中監聽 window 的 load event，當頁面載入時計算當前螢幕寬度大小，再透過 ref 屬性訪問該圖表實例並修改其 options.legend 屬性（和圖例定位相關的屬性）"></a>2. 在 mounted 當中監聽 window 的 load event，當頁面載入時計算當前螢幕寬度大小，再透過 <code>ref</code> 屬性訪問該圖表實例並修改其 <code>options.legend</code> 屬性（和圖例定位相關的屬性）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.windowWidth = <span class="built_in">window</span>.screen.width</span><br><span class="line">      <span class="keyword">let</span> orient, left, bottom</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.windowWidth &lt; <span class="number">480</span>) &#123;</span><br><span class="line">        orient = <span class="string">'horizontal'</span></span><br><span class="line">        left = <span class="string">'center'</span></span><br><span class="line">        bottom = <span class="string">'bottom'</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        orient = <span class="string">'vertical'</span></span><br><span class="line">        left = <span class="string">'left'</span></span><br><span class="line">        bottom = <span class="string">'middle'</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$refs.myChart) &#123;</span><br><span class="line">        <span class="keyword">this</span>.$refs.myChart.options.legend.orient = orient</span><br><span class="line">        <span class="keyword">this</span>.$refs.myChart.options.legend.left = left</span><br><span class="line">        <span class="keyword">this</span>.$refs.myChart.options.legend.bottom = bottom</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：此綁定方法只有在頁面第一次渲染時才會有效，如果要實現 RWD 要再另外監聽 resize 事件。</p>
</blockquote>
<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><h4 id="1-如果要用到較多客製化功能要用-Echarts，否則才用-v-charts"><a href="#1-如果要用到較多客製化功能要用-Echarts，否則才用-v-charts" class="headerlink" title="1. 如果要用到較多客製化功能要用 Echarts，否則才用 v-charts"></a>1. 如果要用到較多客製化功能要用 Echarts，否則才用 v-charts</h4><p>在加入圓餅中間文字那裡卡滿久，原因是一開始裝的是 v-charts（算是輕量簡化版的 Echarts），推測目前還沒有支援到可以使用圖形文字（各種方式加入 <code>graphic</code> 屬性都未起作用），雖然也可能只是尚未找到解決方案（翻文件快翻到發瘋）。</p>
<h4 id="2-在-Vue-當中取得圖表實例的方法"><a href="#2-在-Vue-當中取得圖表實例的方法" class="headerlink" title="2. 在 Vue 當中取得圖表實例的方法"></a>2. 在 Vue 當中取得圖表實例的方法</h4><p>在 <code>options</code> 內部若用到其提供的回調函式，必須使用箭頭函式，拿到的 <code>this</code>才會是我們要的圖表實例物件（否則會是 undefined）。但在其他地方（Vue 的環境中）則要透過訪問 DOM 元素才能得到圖表實例物件。<br>目前的方法是這樣，但其實官方好像有提供其他可以訪問 <code>options</code>的 API（如 <code>computedOptions</code>，可參考<a href="https://github.com/ecomfe/vue-echarts#computed" target="_blank" rel="noopener">文件</a>） ，但我目前是都沒有成功過 QwQ，可能還需另外研究。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/06/23/Vue爺孫組件資料傳遞/" class="prev">上一篇</a></div><div class="copyright"><p>© 2015 - 2019 <a href="https://linxinemily.github.io">Emmie</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>